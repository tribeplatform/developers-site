(self.webpackChunkdevelopers=self.webpackChunkdevelopers||[]).push([[70872],{3905:function(e,t,n){"use strict";n.d(t,{Zo:function(){return d},kt:function(){return c}});var i=n(67294);function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function a(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function r(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?a(Object(n),!0).forEach((function(t){o(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):a(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function s(e,t){if(null==e)return{};var n,i,o=function(e,t){if(null==e)return{};var n,i,o={},a=Object.keys(e);for(i=0;i<a.length;i++)n=a[i],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(i=0;i<a.length;i++)n=a[i],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}var l=i.createContext({}),u=function(e){var t=i.useContext(l),n=t;return e&&(n="function"==typeof e?e(t):r(r({},t),e)),n},d=function(e){var t=u(e.components);return i.createElement(l.Provider,{value:t},e.children)},m={inlineCode:"code",wrapper:function(e){var t=e.children;return i.createElement(i.Fragment,{},t)}},h=i.forwardRef((function(e,t){var n=e.components,o=e.mdxType,a=e.originalType,l=e.parentName,d=s(e,["components","mdxType","originalType","parentName"]),h=u(n),c=o,p=h["".concat(l,".").concat(c)]||h[c]||m[c]||a;return n?i.createElement(p,r(r({ref:t},d),{},{components:n})):i.createElement(p,r({ref:t},d))}));function c(e,t){var n=arguments,o=t&&t.mdxType;if("string"==typeof e||o){var a=n.length,r=new Array(a);r[0]=h;var s={};for(var l in t)hasOwnProperty.call(t,l)&&(s[l]=t[l]);s.originalType=e,s.mdxType="string"==typeof e?e:o,r[1]=s;for(var u=2;u<a;u++)r[u]=n[u];return i.createElement.apply(null,r)}return i.createElement.apply(null,n)}h.displayName="MDXCreateElement"},16273:function(e,t,n){"use strict";n.r(t),n.d(t,{frontMatter:function(){return s},metadata:function(){return l},toc:function(){return u},default:function(){return m}});var i=n(22122),o=n(19756),a=(n(67294),n(3905)),r=["components"],s={sidebar_position:2},l={unversionedId:"guide/single-sign-on/oauth2-sso",id:"guide/single-sign-on/oauth2-sso",isDocsHomePage:!1,title:"OAuth2 SSO",description:"OAuth2 is the recommended and more secure way of implementing SSO between your website and Tribe community. Tribe supports the most common implementations of OAuth2 including OpenID Connect.",source:"@site/docs/guide/single-sign-on/oauth2-sso.md",sourceDirName:"guide/single-sign-on",slug:"/guide/single-sign-on/oauth2-sso",permalink:"/docs/guide/single-sign-on/oauth2-sso",editUrl:"https://github.com/tribeplatform/developers-site/edit/master/docs/guide/single-sign-on/oauth2-sso.md",version:"current",sidebarPosition:2,frontMatter:{sidebar_position:2},sidebar:"guideSidebar",previous:{title:"What is Single Sign-On?",permalink:"/docs/guide/single-sign-on/what-is-single-sign-on"},next:{title:"Getting Started",permalink:"/docs/guide/graphql/getting-started"}},u=[{value:"Bypass OAuth2 login",id:"bypass-oauth2-login",children:[]},{value:"OAuth2 Flow",id:"oauth2-flow",children:[{value:"Identifying User&#39;s Existence",id:"identifying-users-existence",children:[]},{value:"Auto redirecting member to login screen",id:"auto-redirecting-member-to-login-screen",children:[]}]},{value:"OAuth2 Settings",id:"oauth2-settings",children:[{value:"Client ID and Client Secret",id:"client-id-and-client-secret",children:[]},{value:"Identity Provide URL / OAuth2 Domain",id:"identity-provide-url--oauth2-domain",children:[]},{value:"Authorization URL and Token URL",id:"authorization-url-and-token-url",children:[]},{value:"User Profile URL",id:"user-profile-url",children:[]},{value:"Scope",id:"scope",children:[]},{value:"Account Settings URL",id:"account-settings-url",children:[]},{value:"Logout URL",id:"logout-url",children:[]},{value:"Login Button Text",id:"login-button-text",children:[]}]}],d={toc:u};function m(e){var t=e.components,n=(0,o.Z)(e,r);return(0,a.kt)("wrapper",(0,i.Z)({},d,n,{components:t,mdxType:"MDXLayout"}),(0,a.kt)("p",null,"OAuth2 is the recommended and more secure way of implementing SSO between your website and Tribe community. Tribe supports the most common implementations of OAuth2 including ",(0,a.kt)("em",{parentName:"p"},"OpenID Connect"),"."),(0,a.kt)("p",null,"To be able to use OAuth2 SSO method, your website or product should act as an OAuth2 identity provider. If you're using Okta or Auth0 as your user identity management system you can easily enable OAuth2 protocol since they support OAuth2 out of the box."),(0,a.kt)("p",null,"Most content management systems have plugins to support OAuth2 as well. For instance, you can use ",(0,a.kt)("a",{parentName:"p",href:"https://wp-oauth.com/"},"WP OAuth Server")," plugin to add OAuth2 support to your WordPress website."),(0,a.kt)("p",null,'To enable OAuth2 SSO on your Tribe, you can simply go to the Network Settings and enable OAuth2 under Authentication menu. Before enabling the SSO, you should pick your SSO Provider and fill out the mandatory fields. Tribe supports Okta, Auth0, WordPress, Outseta, and Memberful out of the box. In case you\'re using a provider not listed in the dropdown, you can pick the "Custom Provider" option.'),(0,a.kt)("p",null,'Client ID, Client Secret, and the Authorization Domain/URL is mandatory for all providers. For "Custom Provider" you will need to enter the Authorization URL and Token URL as well. You can find these information in your OAuth2 identity management system panel.'),(0,a.kt)("h2",{id:"bypass-oauth2-login"},"Bypass OAuth2 login"),(0,a.kt)("div",{className:"admonition admonition-note alert alert--secondary"},(0,a.kt)("div",{parentName:"div",className:"admonition-heading"},(0,a.kt)("h5",{parentName:"div"},(0,a.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,a.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,a.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"}))),"note")),(0,a.kt)("div",{parentName:"div",className:"admonition-content"},(0,a.kt)("p",{parentName:"div"},"Use ",(0,a.kt)("strong",{parentName:"p"},"https://YOUR_COMMUNITY_DOMAIN/auth/login/direct")," to skip OAuth2 workflow as an admin."))),(0,a.kt)("p",null,"While setting OAuth2 settings you may enter some values incorrectly. Since OAuth2 takes over the login process, you may not be able to access your admin panel anymore to fix issues.\nIn this case, you can easily use ",(0,a.kt)("inlineCode",{parentName:"p"},"https://YOUR_COMMUNITY_DOMAIN/auth/login/direct")," to access Tribe's regular login form."),(0,a.kt)("h2",{id:"oauth2-flow"},"OAuth2 Flow"),(0,a.kt)("p",null,"When OAuth2 SSO is enabled, Tribe will redirect user to your user identity system. If the user is not logged into your website, they will see your login screen. After logging in, Tribe will receive the access token generated by your user identity system and fetches the user's information."),(0,a.kt)("p",null,"Next, Tribe will create the user using the provided information and log them in if the user does not already exist. If the user exists, it will update the user's information and log them in."),(0,a.kt)("div",{className:"admonition admonition-note alert alert--secondary"},(0,a.kt)("div",{parentName:"div",className:"admonition-heading"},(0,a.kt)("h5",{parentName:"div"},(0,a.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,a.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,a.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"}))),"note")),(0,a.kt)("div",{parentName:"div",className:"admonition-content"},(0,a.kt)("p",{parentName:"div"},"When member clicks on the login or sign up button, in case you have more than one login method enabled (e.g. OAuth2 + social logins or OAuth2 + email/password) the member will see Tribe's login screen with the available login options. If OAuth2 is the only available login method, the member will be redirected directly to your identity management system."))),(0,a.kt)("h3",{id:"identifying-users-existence"},"Identifying User's Existence"),(0,a.kt)("p",null,"Tribe will first try to find the user using the provided id. It will check if any user has externalId equal to provided id. If the user is found, it will update their information including their email address."),(0,a.kt)("p",null,"If no user is found based on externalId == id, it will try to find the user using the email address provided and connects the user's externalId to the provided id."),(0,a.kt)("div",{className:"admonition admonition-warning alert alert--danger"},(0,a.kt)("div",{parentName:"div",className:"admonition-heading"},(0,a.kt)("h5",{parentName:"div"},(0,a.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,a.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"12",height:"16",viewBox:"0 0 12 16"},(0,a.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M5.05.31c.81 2.17.41 3.38-.52 4.31C3.55 5.67 1.98 6.45.9 7.98c-1.45 2.05-1.7 6.53 3.53 7.7-2.2-1.16-2.67-4.52-.3-6.61-.61 2.03.53 3.33 1.94 2.86 1.39-.47 2.3.53 2.27 1.67-.02.78-.31 1.44-1.13 1.81 3.42-.59 4.78-3.42 4.78-5.56 0-2.84-2.53-3.22-1.25-5.61-1.52.13-2.03 1.13-1.89 2.75.09 1.08-1.02 1.8-1.86 1.33-.67-.41-.66-1.19-.06-1.78C8.18 5.31 8.68 2.45 5.05.32L5.03.3l.02.01z"}))),"warning")),(0,a.kt)("div",{parentName:"div",className:"admonition-content"},(0,a.kt)("p",{parentName:"div"},"If a user with externalId == id check does not exist and the user matching with email already has an externalId, Tribe will through a conflict error."),(0,a.kt)("p",{parentName:"div"},'In this case, you may want to update existing users externalId or email using "Update a Specific User" API.'))),(0,a.kt)("h3",{id:"auto-redirecting-member-to-login-screen"},"Auto redirecting member to login screen"),(0,a.kt)("p",null,"Sometimes you want to ensure the user is logged into the community. This usually happens when you're embedding the Tribe community into another website or product using Iframe. To make sure the user is logged in you can pass ",(0,a.kt)("inlineCode",{parentName:"p"},"?auth=true")," query string in the URL. When this query string is set, the flow will be as follows:"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"If the user is not logged in, it will redirect the user to the OAuth2 workflow and it'll log user in."),(0,a.kt)("li",{parentName:"ul"},"If the user is already logged in, it won't do anything.")),(0,a.kt)("p",null,"Please note that this method works seamlessly if the user is already authenticated in your identity management system. For instance, on the web, you're already sure that the user is authenticated to your app using the identity management system, therefore when the widget redirects user to the OAuth2 workflow user will be logged in and redirected back right away."),(0,a.kt)("p",null,"If the user is not authenticated using your identity management system, they will see the OAuth2 login screen and it won't be a seamless experience. This mostly happens when you're using a WebView inside your app, and the WebView has a different session from the main App's authentication flow."),(0,a.kt)("div",{className:"admonition admonition-note alert alert--secondary"},(0,a.kt)("div",{parentName:"div",className:"admonition-heading"},(0,a.kt)("h5",{parentName:"div"},(0,a.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,a.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,a.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"}))),"note")),(0,a.kt)("div",{parentName:"div",className:"admonition-content"},(0,a.kt)("p",{parentName:"div"},"Before using ",(0,a.kt)("inlineCode",{parentName:"p"},"?auth=true"),", please ensure the only available login method is OAuth2. If you have email/password or social login methods enabled, the member will see the Tribe login screen instead of being redirected to the OAuth2 flow."))),(0,a.kt)("h2",{id:"oauth2-settings"},"OAuth2 Settings"),(0,a.kt)("p",null,"Now let's go through every single option available under the OAuth settings:"),(0,a.kt)("h3",{id:"client-id-and-client-secret"},"Client ID and Client Secret"),(0,a.kt)("p",null,"Both of these values are generated by your identity management system. They are the credentials that give Tribe access to act as an authentication client."),(0,a.kt)("p",null,"In Okta or Auth0 you can get these credentials by adding a new App. The Client ID and Secret will be available under the app settings."),(0,a.kt)("div",{className:"admonition admonition-info alert alert--info"},(0,a.kt)("div",{parentName:"div",className:"admonition-heading"},(0,a.kt)("h5",{parentName:"div"},(0,a.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,a.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,a.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"}))),"info")),(0,a.kt)("div",{parentName:"div",className:"admonition-content"},(0,a.kt)("p",{parentName:"div"},"Please make sure to set the callback URL as instructed at the bottom of OAuth2 app under your identity management system's Callback URL or Callback URI section."))),(0,a.kt)("h3",{id:"identity-provide-url--oauth2-domain"},"Identity Provide URL / OAuth2 Domain"),(0,a.kt)("p",null,"This URL is provided by your identity management system. It\u2019s the base URL you chose upon setting up your identity management account."),(0,a.kt)("p",null,"As an example, For Memberful, this URL look like this:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},"https://{YourSubdomain}.memberful.com\n")),(0,a.kt)("h3",{id:"authorization-url-and-token-url"},"Authorization URL and Token URL"),(0,a.kt)("p",null,"Custom OAuth2 provider requires two URLs to work properly. These URLs are also provided by your identity management system."),(0,a.kt)("p",null,"For other providers Tribe will generate these values based on the OAuth2 domain."),(0,a.kt)("h3",{id:"user-profile-url"},"User Profile URL"),(0,a.kt)("p",null,"If your OAuth2 provider follows OpenID Connect standards, user's information will be included inside ",(0,a.kt)("inlineCode",{parentName:"p"},"id_token")," JWT and there will not be a need for Tribe to send another request to get user's information."),(0,a.kt)("p",null,"However, if all the information needed (User's id, email, and name) are not provided inside the id_token or the OAuth2 provider does not follow OpenID Connect, you'll need to provide another URL for Tribe to fetch needed user's information. You can enter this URL in User Info URL textbox."),(0,a.kt)("p",null,"Tribe will send a GET request to this URL and expects the user's information in JSON format. The request includes the access token in the header according to bearer authentication:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},"Authorization: Bearer {AccessToken}\n")),(0,a.kt)("p",null,"Tribe maps the JSON result to Tribe user's object as followed considering the order mentioned for each field:"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"externalId"),": id, ID, userId"),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"email"),": email, user_email"),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"name"),": name, display_name, displayName, full_name, pseudo"),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"username"),": username, user_login, nickname"),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"profilePicture"),": picture, icon_url"),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"fields"),": fields")),(0,a.kt)("p",null,"If externalId is not available in the root JSON object, Tribe will also look for data key for all keys mentioned above (e.g. ",(0,a.kt)("inlineCode",{parentName:"p"},"data.id"),", ",(0,a.kt)("inlineCode",{parentName:"p"},"data.name"),", etc.)"),(0,a.kt)("p",null,"The above mapping covers most of the standard user info endpoints including WP OAuth Server. Custom mapping implementation is available for Enterprise clients."),(0,a.kt)("h3",{id:"scope"},"Scope"),(0,a.kt)("p",null,"Scope defines the member fields and the permission that Tribe should have access to. If you're not sure what it is, you can skip entering any value for it."),(0,a.kt)("p",null,'If your OAuth2 provider follows OpenID Connect standards, you can enter "email openid". This will let Tribe have access to user\'s email as well as their basic information.'),(0,a.kt)("h3",{id:"account-settings-url"},"Account Settings URL"),(0,a.kt)("p",null,"Your community members can change their email inside Tribe by default. Most likely there is a section on your identity management system where users can change their email as well. This will cause confusion for your members since they can update their information in two different places and they're not synced by default."),(0,a.kt)("p",null,'For instance, a member with "',(0,a.kt)("a",{parentName:"p",href:"mailto:john.smith@acme.com"},"john.smith@acme.com"),'" email can update their address in the community to "',(0,a.kt)("a",{parentName:"p",href:"mailto:j.smith@test.com"},"j.smith@test.com"),'", unless you\'re using our Webhooks, API, and/or Zapier the email of this user on your identity management system is still "',(0,a.kt)("a",{parentName:"p",href:"mailto:john-smith@acme.com"},"john-smith@acme.com"),'". In some cases, this might be the right behavior and you want to let members have a different email addresses in the community. But in many cases, you want the emails to be synced and in this case, the best solution is to let them change their information only inside your identity management system.'),(0,a.kt)("p",null,"To do so, you can just enter a link to your website's account setting URL. If this link is provided we won't let members change their email inside the community and instead they will see a link to your website's account setting. After they change their information you can use our API or Zapier to update their name right away in the community. Otherwise, their information will be updated the next time they login to Tribe."),(0,a.kt)("h3",{id:"logout-url"},"Logout URL"),(0,a.kt)("p",null,"When the user logs out of the community, most likely, you want them to be logged out of your identity management system as well. Otherwise, next time they click on the login button, after being redirected to your identity management system authorization URL, the user will be logged in to the community right away without asking for username and password because they're not logged out of the identity management system yet."),(0,a.kt)("p",null,"To fix this, you can provide a Logout URL. After the user is logged out of Tribe we're sending them to the URL provided and you can log them out of the identity management system as well."),(0,a.kt)("h3",{id:"login-button-text"},"Login Button Text"),(0,a.kt)("p",null,"If \u201cEnable OAuth2\u201d is checked, we will show a button pointing to your Single Sign-On provider. You can set the name of the SSO button under the Login Button Text textbox."))}m.isMDXComponent=!0}}]);